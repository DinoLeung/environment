version: '2.1'

services:
  data:
    extends:
      file: data.yml
      service: data

  data-cache:
    extends:
      file: data.yml
      service: data-cache

  composer:
    extends:
      file: composer/composer.yml
      service: composer
    command: /bin/true
    volumes_from:
      - data
      - data-cache
    env_file:
      - env/${DB:-mysql}
      - env/${ORO_SEARCH_ENGINE:-orm}
      - env/functional
    logging:
      driver: ${DOCKER_LOG_DRIVER:-json-file}

  database:
    extends:
      file: ${DB:-mysql}/${DB:-mysql}.yml
      service: database
    volumes_from:
      - data
    logging:
      driver: ${DOCKER_LOG_DRIVER:-json-file}

  php:
    extends:
      file: php/php.yml
      service: php
    depends_on:
      - composer
      - data
      - data-cache
    links:
      - database
    volumes_from:
      - data
      - data-cache
    env_file:
      - env/${DB:-mysql}
      - env/${ORO_SEARCH_ENGINE:-orm}
      - env/functional
    logging:
      driver: ${DOCKER_LOG_DRIVER:-json-file}

networks:
  default:
    ipam:
      config:
        - subnet: 172.${NETWORK:-173}.${SUB_NETWORK:-0}.0/27
